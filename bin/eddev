#!/usr/bin/env php
<?php declare(strict_types=1);

use GuySartorelli\DdevWrapper\Application\Application;
use Symfony\Component\Dotenv\Dotenv;
use Symfony\Component\Filesystem\Path;

if (PHP_VERSION_ID < 80100) {
    echo 'Silverstripe Developer Kit requires at least PHP 8.1 and you are running ' . PHP_VERSION
     . ', please upgrade PHP. Aborting.' . PHP_EOL;
    exit(1);
}

$autoloadFile = __DIR__ . DIRECTORY_SEPARATOR . '..' . DIRECTORY_SEPARATOR . 'vendor' . DIRECTORY_SEPARATOR . 'autoload.php';
if (!file_exists($autoloadFile)) {
    throw new RuntimeException('You need to run `composer install` to get the relevant dependencies');
}
require_once $autoloadFile;

// Boot environment variables
$envFilePath = Path::canonicalize(Path::join(__DIR__, '../', '.env'));
if (!file_exists($envFilePath)) {
    throw new RuntimeException('.env file not found. Copy the ".env.example" file to ".env" and set the values appropriately.');
}
$envConfig = new Dotenv();
$envConfig->usePutenv(true);
$envConfig->bootEnv($envFilePath);

// Start app
$application = new Application('eddev');
$application->run();
